"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var _glob=require("glob"),_glob2=_interopRequireDefault(_glob),_ndcExecute=require("./ndcExecute"),_ndcExecute2=_interopRequireDefault(_ndcExecute),loadActions=function(e){return new Promise(function(n,t){(0,_glob2["default"])(e+"/**/actions/*.js",{},function(e,r){return e?t(e):void n(r.map(function(e){var n=require(e)["default"];return n.file=e,n}))})})},organize=function(e){for(var n={},t=0,r=e.length;r>t;t++){var o=e[t],u=o.actionName,i=o.file,c=n.hasOwnProperty(u);if(c)throw new Error('Duplicity of action: "'+u+'" on files: "'+i+'" and "'+n[u].file+'"');n[u]=o}return n},ndcActions=function(e){return loadActions(e).then(organize).then(function(e){return e.execute=_ndcExecute2["default"],e})};exports["default"]=ndcActions,Object.defineProperty(exports,"__esModule",{value:!0});var _ndcRoutes=require("./ndcRoutes"),_ndcRoutes2=_interopRequireDefault(_ndcRoutes),_ndcActions=require("./ndcActions"),_ndcActions2=_interopRequireDefault(_ndcActions),ndcConfigs=function(e){return(0,_ndcRoutes2["default"])(e).then(function(n){return(0,_ndcActions2["default"])(e).then(function(e){return{routes:n,actions:e}})})};exports["default"]=ndcConfigs,Object.defineProperty(exports,"__esModule",{value:!0});var ndcExecute=function(e){var n=this,t=e.exec.map(function(e){return n[e]}),r=Promise.resolve();return t.forEach(function(n){r=r.then(function(t){return n(t||{},e)})}),r.then(function(e){return e||{}})};exports["default"]=ndcExecute,Object.defineProperty(exports,"__esModule",{value:!0});var _ndcConfigs=require("./ndcConfigs"),_ndcConfigs2=_interopRequireDefault(_ndcConfigs),ndcRest=function(e){var n=e.path,t=e.app;return(0,_ndcConfigs2["default"])(n).then(function(e){return Object.keys(e.routes).map(function(n){return e.routes[n]}).forEach(function(n){var r=n.verb,o=n.path,u=n.exec;t[r](o,function(n,r,o){var i={app:t,req:n,res:r,config:e,exec:u};e.actions.execute(i).then(o)})}),t})};exports["default"]=ndcRest,Object.defineProperty(exports,"__esModule",{value:!0});var _glob=require("glob"),_glob2=_interopRequireDefault(_glob),loadRoutes=function(e){return new Promise(function(n,t){var r=e+"/**/*Rest.json";(0,_glob2["default"])(r,{},function(e,r){if(e)return t(e);var o=[];r.forEach(function(e){require(e).forEach(function(n){n.file=e,o.push(n)})}),n(o)})})},organize=function(e){for(var n={},t=0,r=e.length;r>t;t++){var o=e[t],u=o.verb,i=o.path,c=o.file,f=u.toUpperCase()+": "+i,a=n.hasOwnProperty(f);if(a)throw new Error('Duplicity of route: "'+f+'" on files: "'+c+'" and "'+n[f].file+'"');n[f]=o}return n},ndcRoutes=function(e){return loadRoutes(e).then(organize)};exports["default"]=ndcRoutes;